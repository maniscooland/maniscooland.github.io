<!DOCTYPE html>
<html>
<head>
    <title>Battle Royale</title>
    <style>
        * { margin: 0; padding: 0; overflow: hidden; }
        canvas { display: block; background: #90EE90; }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        class Character {
            constructor(x, y, team = 'neutral') {
                this.x = x;
                this.y = y;
                this.rotation = 0;
                this.speed = 4;
                this.health = 100;
                this.team = team;
                this.vehicle = null;
                this.target = null;
                this.state = 'wandering';
                this.color = this.getTeamColor();
                this.isAI = true;
            }

            getTeamColor() {
                return {
                    'red': '#ff4444',
                    'blue': '#4444ff',
                    'green': '#44ff44',
                    'neutral': '#aaaaaa',
                    'player': '#ffff44'
                }[this.team] || '#aaaaaa';
            }

            draw() {
                if (this.vehicle) return;
                
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(this.rotation);

                // Health bar
                ctx.fillStyle = '#ff0000';
                ctx.fillRect(-20, -30, 40, 5);
                ctx.fillStyle = '#00ff00';
                ctx.fillRect(-20, -30, 40 * (this.health/100), 5);
                
                // Body
                ctx.beginPath();
                ctx.arc(0, 0, 20, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                ctx.fill();
                
                // Arms
                ctx.fillRect(15, -10, 10, 10);
                ctx.fillRect(15, 0, 10, 10);
                
                ctx.restore();
            }

            update() {
                if (this.health <= 0) return;

                if (this.isAI) {
                    if (!this.vehicle) {
                        if (!this.target || this.reachedTarget()) {
                            this.target = {
                                x: Math.random() * canvas.width,
                                y: Math.random() * canvas.height
                            };
                        }
                        
                        const dx = this.target.x - this.x;
                        const dy = this.target.y - this.y;
                        this.rotation = Math.atan2(dy, dx);
                        
                        this.x += Math.cos(this.rotation) * this.speed;
                        this.y += Math.sin(this.rotation) * this.speed;

                        // Random vehicle entry
                        if (Math.random() < 0.01) {
                            vehicles.forEach(v => {
                                if (!v.driver && Math.hypot(v.x - this.x, v.y - this.y) < 50) {
                                    this.vehicle = v;
                                    v.driver = this;
                                }
                            });
                        }
                    } else {
                        if (Math.random() < 0.005) {
                            this.vehicle.driver = null;
                            this.vehicle = null;
                        }
                    }
                }
            }

            reachedTarget() {
                return Math.hypot(this.target.x - this.x, this.target.y - this.y) < 50;
            }
        }

        class Vehicle {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.width = 80;
                this.height = 40;
                this.wheelBase = 40;
                this.wheelAngle = 0;
                this.maxWheelAngle = Math.PI/4;
                this.rotation = 0;
                this.speed = 0;
                this.maxSpeed = 5;
                this.acceleration = 0.2;
                this.friction = 0.98;
                this.driver = null;
            }

            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(this.rotation);

                // Car body
                ctx.fillStyle = '#444444';
                ctx.fillRect(-this.width/2, -this.height/2, this.width, this.height);

                // Wheels
                ctx.fillStyle = '#000';
                // Back wheels (fixed)
                ctx.fillRect(-this.width/2, -this.height/2 - 5, 10, 5);
                ctx.fillRect(-this.width/2, this.height/2, 10, 5);
                
                // Front wheels (turning)
                ctx.save();
                ctx.translate(this.width/2 - 10, -this.height/2 - 5);
                ctx.rotate(this.wheelAngle);
                ctx.fillRect(0, 0, 10, 5);
                ctx.restore();

                ctx.save();
                ctx.translate(this.width/2 - 10, this.height/2);
                ctx.rotate(this.wheelAngle);
                ctx.fillRect(0, 0, 10, 5);
                ctx.restore();

                // Draw driver
                if (this.driver) {
                    ctx.save();
                    ctx.rotate(this.rotation * -1);
                    
                    ctx.beginPath();
                    ctx.arc(0, 0, 20, 0, Math.PI * 2);
                    ctx.fillStyle = this.driver.color;
                    ctx.fill();
                    
                    ctx.fillRect(15, -10, 10, 10);
                    ctx.fillRect(15, 0, 10, 10);
                    
                    ctx.restore();
                }

                ctx.restore();
            }

            update() {
                if (this.driver) {
                    if (!this.driver.isAI) {
                        if (keys.w) this.speed = Math.min(this.maxSpeed, this.speed + this.acceleration);
                        if (keys.s) this.speed = Math.max(-this.maxSpeed/2, this.speed - this.acceleration);
                        if (keys.a) this.wheelAngle = Math.max(-this.maxWheelAngle, this.wheelAngle - 0.1);
                        if (keys.d) this.wheelAngle = Math.min(this.maxWheelAngle, this.wheelAngle + 0.1);
                        if (!keys.a && !keys.d) this.wheelAngle *= 0.5;
                    } else {
                        this.speed = 3;
                        this.wheelAngle = Math.sin(Date.now() / 1000) * this.maxWheelAngle;
                    }

                    this.speed *= this.friction;

                    if (Math.abs(this.speed) > 0.1) {
                        const turnRadius = this.wheelBase / Math.sin(this.wheelAngle || 0.0001);
                        this.rotation += this.speed / turnRadius;
                    }

                    this.x += Math.cos(this.rotation) * this.speed;
                    this.y += Math.sin(this.rotation) * this.speed;

                    this.x = Math.max(this.width/2, Math.min(canvas.width - this.width/2, this.x));
                    this.y = Math.max(this.height/2, Math.min(canvas.height - this.height/2, this.y));
                }
            }
        }

        // Create game objects
        const player = new Character(400, 300, 'player');
        player.isAI = false;

        const vehicles = Array(6).fill().map(() => new Vehicle(
            Math.random() * (canvas.width - 200) + 100,
            Math.random() * (canvas.height - 200) + 100
        ));

        const characters = [
            player,
            new Character(200, 200, 'red'),
            new Character(600, 200, 'blue'),
            new Character(200, 600, 'green'),
            new Character(600, 600, 'red')
        ];

        // Controls
        const keys = {w: false, s: false, a: false, d: false, e: false};
        let mouseX = 0, mouseY = 0;

        window.addEventListener('keydown', e => keys[e.key] = true);
        window.addEventListener('keyup', e => keys[e.key] = false);
        window.addEventListener('mousemove', e => {
            mouseX = e.clientX;
            mouseY = e.clientY;
        });

        // Player controls
        function updatePlayer() {
            if (!player.vehicle) {
                if (keys.w) player.y -= player.speed;
                if (keys.s) player.y += player.speed;
                if (keys.a) player.x -= player.speed;
                if (keys.d) player.x += player.speed;
                
                const dx = mouseX - player.x;
                const dy = mouseY - player.y;
                player.rotation = Math.atan2(dy, dx);

                if (keys.e) {
                    vehicles.forEach(v => {
                        if (!v.driver && Math.hypot(v.x - player.x, v.y - player.y) < 50) {
                            player.vehicle = v;
                            v.driver = player;
                        }
                    });
                }
            } else {
                player.rotation = player.vehicle.rotation;
                if (keys.e) {
                    player.x = player.vehicle.x;
                    player.y = player.vehicle.y;
                    player.vehicle.driver = null;
                    player.vehicle = null;
                }
            }
        }

        // Game loop
        function gameLoop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Update and draw everything
            vehicles.forEach(v => {
                v.update();
                v.draw();
            });
            
            characters.forEach(char => {
                char.update();
                char.draw();
            });
            
            updatePlayer();
            
            requestAnimationFrame(gameLoop);
        }

        gameLoop();
    </script>
</body>
</html>
