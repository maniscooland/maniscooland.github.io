<!DOCTYPE html>
<html>
<head>
    <title>Massive World Battle</title>
    <style>
        * { margin: 0; padding: 0; overflow: hidden; }
        canvas { display: block; }
        .menu {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            background: rgba(0, 0, 0, 0.8);
            padding: 40px;
            border-radius: 10px;
            color: white;
        }
        .menu input {
            font-size: 20px;
            padding: 10px;
            margin: 10px;
            width: 200px;
            border-radius: 5px;
        }
        .weapon-select {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 20px;
        }
        .weapon-option {
            padding: 10px;
            cursor: pointer;
            border: 2px solid transparent;
            border-radius: 5px;
        }
        .weapon-option.selected {
            border-color: #4CAF50;
            background: rgba(76, 175, 80, 0.2);
        }
        .weapon-option img {
            width: 100px;
            height: 100px;
        }
        .start-button {
            font-size: 24px;
            padding: 15px 30px;
            margin: 10px;
            background: #4CAF50;
            border: none;
            border-radius: 5px;
            color: white;
            cursor: pointer;
            transition: 0.3s;
        }
        .start-button:hover {
            background: #45a049;
            transform: scale(1.1);
        }
    </style>
</head>
<body>
    <div id="mainMenu" class="menu">
        <h1>Massive World Battle</h1>
        <input type="text" id="username" placeholder="Enter Username" maxlength="15">
        
        <div class="weapon-select">
            <div class="weapon-option selected" onclick="selectWeapon('pistol')">
                <img src="pistolD.png">
                <p>Pistol</p>
            </div>
            <div class="weapon-option" onclick="selectWeapon('shotgun')">
                <img src="shotgunD.png">
                <p>Shotgun</p>
            </div>
            <div class="weapon-option" onclick="selectWeapon('rifle')">
                <img src="rifleD.png">
                <p>Rifle</p>
            </div>
            <div class="weapon-option" onclick="selectWeapon('aShotgun')">
                <img src="aShotgunD.png">
                <p>Auto Shotgun</p>
            </div>
        </div>

        <button class="start-button" onclick="startGame()">Start Game</button>
    </div>

    <canvas id="gameCanvas"></canvas>
    <script>
        let selectedWeapon = 'pistol';
        let playerUsername = '';
        let gameStarted = false;

        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const glove1 = new Image();
        const glove2 = new Image();
        const pistol = new Image();
        const shotgun = new Image();
        const rifle = new Image();
        const aShotgun = new Image();
        const pistolD = new Image();
        const shotgunD = new Image();
        const rifleD = new Image();
        const aShotgunD = new Image();

        glove1.src = 'ga1.png';
        glove2.src = 'ga2.png';
        pistol.src = 'pistol.png';
        shotgun.src = 'shotgun.png';
        rifle.src = 'rifle.png';
        aShotgun.src = 'aShotgun.png';
        pistolD.src = 'pistolD.png';
        shotgunD.src = 'shotgunD.png';
        rifleD.src = 'rifleD.png';
        aShotgunD.src = 'aShotgunD.png';

        const WORLD_WIDTH = 90000;
        const WORLD_HEIGHT = 90000;
        const SCENE_SIZE = WORLD_WIDTH / 2;

        const SCENES = {
            forest: {
                background: '#2D5A27',
                pathColor: '#8B4513',
                pathBorder: '#654321'
            },
            desert: {
                background: '#DAA520',
                pathColor: '#D2691E',
                pathBorder: '#8B4513'
            },
            mountain: {
                background: '#4A5D23',
                pathColor: '#8B4513',
                pathBorder: '#654321'
            },
            lake: {
                background: '#1E4D2B',
                pathColor: '#8B4513',
                pathBorder: '#654321'
            }
        };

        const paths = [
            {x: 0, y: WORLD_HEIGHT/2 - 1000, width: WORLD_WIDTH, height: 2000},
            {x: WORLD_WIDTH/2 - 1000, y: 0, width: 2000, height: WORLD_HEIGHT},
            {x: WORLD_WIDTH/4, y: WORLD_HEIGHT/4, width: 2000, height: WORLD_HEIGHT/2, rotation: Math.PI/4},
            {x: WORLD_WIDTH*3/4, y: WORLD_HEIGHT/4, width: 2000, height: WORLD_HEIGHT/2, rotation: -Math.PI/4}
        ];

        const camera = {
            x: 0,
            y: 0,
            scale: 0.25,
            follow(target) {
                const targetX = -target.x * this.scale + canvas.width/2;
                const targetY = -target.y * this.scale + canvas.height/2;
                this.x += (targetX - this.x) * 0.1;
                this.y += (targetY - this.y) * 0.1;
            }
        };

        class Character {
            constructor(x, y, team = 'neutral') {
                this.x = x;
                this.y = y;
                this.rotation = 0;
                this.speed = 15;
                this.health = 100;
                this.team = team;
                this.vehicle = null;
                this.target = null;
                this.color = this.getTeamColor();
                this.isAI = true;
                this.weapon = 'pistol';
                this.username = '';
            }

            getTeamColor() {
                return {
                    'red': '#ff4444',
                    'blue': '#4444ff',
                    'green': '#44ff44',
                    'player': '#ffff44'
                }[this.team] || '#aaaaaa';
            }

            draw() {
                if (this.vehicle) return;
                
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(this.rotation);

                ctx.fillStyle = '#ff0000';
                ctx.fillRect(-40, -60, 80, 10);
                ctx.fillStyle = '#00ff00';
                ctx.fillRect(-40, -60, 80 * (this.health/100), 10);
                
                if (this.username) {
                    ctx.fillStyle = 'white';
                    ctx.font = '16px Arial';
                    ctx.fillText(this.username, -30, -70);
                }

                ctx.beginPath();
                ctx.arc(0, 0, 40, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                ctx.fill();
                
                ctx.drawImage(glove1, 30, -20, 80, 80);
                ctx.drawImage(glove2, 30, 0, 80, 80);

                const weaponImg = window[this.weapon];
                if (weaponImg) {
                    ctx.drawImage(weaponImg, 40, -10, 60, 20);
                }
                
                ctx.restore();
            }

            update() {
                if (this.health <= 0) return;

                if (this.isAI) {
                    if (!this.vehicle) {
                        if (!this.target || this.reachedTarget()) {
                            this.target = {
                                x: Math.random() * WORLD_WIDTH,
                                y: Math.random() * WORLD_HEIGHT
                            };
                        }
                        
                        const dx = this.target.x - this.x;
                        const dy = this.target.y - this.y;
                        this.rotation = Math.atan2(dy, dx);
                        
                        this.x += Math.cos(this.rotation) * this.speed;
                        this.y += Math.sin(this.rotation) * this.speed;

                        if (Math.random() < 0.01) {
                            vehicles.forEach(v => {
                                if (!v.driver && Math.hypot(v.x - this.x, v.y - this.y) < 100) {
                                    this.vehicle = v;
                                    v.driver = this;
                                }
                            });
                        }
                    } else {
                        if (Math.random() < 0.005) {
                            this.vehicle.driver = null;
                            this.vehicle = null;
                        }
                    }
                }

                this.x = Math.max(0, Math.min(WORLD_WIDTH, this.x));
                this.y = Math.max(0, Math.min(WORLD_HEIGHT, this.y));
            }

            reachedTarget() {
                return Math.hypot(this.target.x - this.x, this.target.y - this.y) < 100;
            }
        }

        class Vehicle {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.width = 160;
                this.height = 80;
                this.wheelBase = 80;
                this.wheelAngle = 0;
                this.maxWheelAngle = Math.PI/4;
                this.rotation = 0;
                this.speed = 0;
                this.maxSpeed = 30;
                this.acceleration = 0.4;
                this.friction = 0.98;
                this.driver = null;
            }

            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(this.rotation);

                ctx.fillStyle = '#444444';
                ctx.fillRect(-this.width/2, -this.height/2, this.width, this.height);

                ctx.fillStyle = '#000';
                ctx.fillRect(-this.width/2, -this.height/2 - 5, 20, 10);
                ctx.fillRect(-this.width/2, this.height/2, 20, 10);
                
                ctx.save();
                ctx.translate(this.width/2 - 20, -this.height/2 - 5);
                ctx.rotate(this.wheelAngle);
                ctx.fillRect(0, 0, 20, 10);
                ctx.restore();

                ctx.save();
                ctx.translate(this.width/2 - 20, this.height/2);
                ctx.rotate(this.wheelAngle);
                ctx.fillRect(0, 0, 20, 10);
                ctx.restore();

                if (this.driver) {
                    ctx.save();
                    ctx.rotate(this.rotation * -1);
                    
                    ctx.beginPath();
                    ctx.arc(0, 0, 40, 0, Math.PI * 2);
                    ctx.fillStyle = this.driver.color;
                    ctx.fill();
                    
                    ctx.drawImage(glove1, 30, -20, 80, 80);
                    ctx.drawImage(glove2, 30, 0, 80, 80);

                    const weaponImg = window[this.driver.weapon];
                    if (weaponImg) {
                        ctx.drawImage(weaponImg, 40, -10, 60, 20);
                    }
                    
                    ctx.restore();
                }

                ctx.restore();
            }

            update() {
                if (this.driver) {
                    if (!this.driver.isAI) {
                        if (keys.w) this.speed = Math.min(this.maxSpeed, this.speed + this.acceleration);
                        if (keys.s) this.speed = Math.max(-this.maxSpeed/2, this.speed - this.acceleration);
                        if (keys.a) this.wheelAngle = Math.max(-this.maxWheelAngle, this.wheelAngle - 0.1);
                        if (keys.d) this.wheelAngle = Math.min(this.maxWheelAngle, this.wheelAngle + 0.1);
                        if (!keys.a && !keys.d) this.wheelAngle *= 0.5;
                    } else {
                        this.speed = 12;
                        this.wheelAngle = Math.sin(Date.now() / 1000) * this.maxWheelAngle;
                    }

                    this.speed *= this.friction;

                    if (Math.abs(this.speed) > 0.1) {
                        const turnRadius = this.wheelBase / Math.sin(this.wheelAngle || 0.0001);
                        this.rotation += this.speed / turnRadius;
                    }

                    this.x += Math.cos(this.rotation) * this.speed;
                    this.y += Math.sin(this.rotation) * this.speed;

                    this.x = Math.max(this.width/2, Math.min(WORLD_WIDTH - this.width/2, this.x));
                    this.y = Math.max(this.height/2, Math.min(WORLD_HEIGHT - this.height/2, this.y));
                }
            }
        }

        function selectWeapon(weapon) {
            selectedWeapon = weapon;
            document.querySelectorAll('.weapon-option').forEach(option => {
                option.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
        }

        function startGame() {
            playerUsername = document.getElementById('username').value;
            if (!playerUsername) {
                alert('Please enter a username!');
                return;
            }
            document.getElementById('mainMenu').style.display = 'none';
            gameStarted = true;
            initGame();
        }

        function drawRotatedRect(x, y, width, height, rotation = 0) {
            ctx.save();
            ctx.translate(x + width/2, y + height/2);
            ctx.rotate(rotation);
            ctx.fillRect(-width/2, -height/2, width, height);
            ctx.restore();
        }

        function getSceneAtPosition(x, y) {
            const sceneX = Math.floor(x / SCENE_SIZE);
            const sceneY = Math.floor(y / SCENE_SIZE);
                        const scenes = ['forest', 'desert', 'mountain', 'lake'];
            return scenes[(sceneY * 2 + sceneX) % scenes.length];
        }

        function drawWorld() {
            for(let x = 0; x < 2; x++) {
                for(let y = 0; y < 2; y++) {
                    const scene = getSceneAtPosition(x * SCENE_SIZE, y * SCENE_SIZE);
                    ctx.fillStyle = SCENES[scene].background;
                    ctx.fillRect(x * SCENE_SIZE, y * SCENE_SIZE, SCENE_SIZE, SCENE_SIZE);
                }
            }

            paths.forEach(path => {
                ctx.fillStyle = SCENES[getSceneAtPosition(path.x, path.y)].pathColor;
                drawRotatedRect(path.x, path.y, path.width, path.height, path.rotation || 0);
                
                ctx.strokeStyle = SCENES[getSceneAtPosition(path.x, path.y)].pathBorder;
                ctx.lineWidth = 5;
                ctx.save();
                ctx.translate(path.x + path.width/2, path.y + path.height/2);
                ctx.rotate(path.rotation || 0);
                ctx.strokeRect(-path.width/2, -path.height/2, path.width, path.height);
                ctx.restore();
            });
        }

        const player = new Character(WORLD_WIDTH/2, WORLD_HEIGHT/2, 'player');
        player.isAI = false;

        const vehicles = Array(200).fill().map(() => new Vehicle(
            Math.random() * (WORLD_WIDTH - 400) + 200,
            Math.random() * (WORLD_HEIGHT - 400) + 200
        ));

        const characters = [
            player,
            ...Array(100).fill().map(() => new Character(
                Math.random() * WORLD_WIDTH,
                Math.random() * WORLD_HEIGHT,
                ['red', 'blue', 'green'][Math.floor(Math.random() * 3)]
            ))
        ];

        const keys = {w: false, s: false, a: false, d: false, e: false};
        let mouseX = 0, mouseY = 0;

        window.addEventListener('keydown', e => keys[e.key] = true);
        window.addEventListener('keyup', e => keys[e.key] = false);
        window.addEventListener('mousemove', e => {
            mouseX = e.clientX/camera.scale - camera.x/camera.scale;
            mouseY = e.clientY/camera.scale - camera.y/camera.scale;
        });

        function updatePlayer() {
            if (!player.vehicle) {
                if (keys.w) player.y -= player.speed;
                if (keys.s) player.y += player.speed;
                if (keys.a) player.x -= player.speed;
                if (keys.d) player.x += player.speed;
                
                const dx = mouseX - player.x;
                const dy = mouseY - player.y;
                player.rotation = Math.atan2(dy, dx);

                if (keys.e) {
                    vehicles.forEach(v => {
                        if (!v.driver && Math.hypot(v.x - player.x, v.y - player.y) < 100) {
                            player.vehicle = v;
                            v.driver = player;
                        }
                    });
                }
            } else {
                player.rotation = player.vehicle.rotation;
                if (keys.e) {
                    player.x = player.vehicle.x;
                    player.y = player.vehicle.y;
                    player.vehicle.driver = null;
                    player.vehicle = null;
                }
            }
        }

        function initGame() {
            player.weapon = selectedWeapon;
            player.username = playerUsername;
            gameLoop();
        }

        function gameLoop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            ctx.save();
            ctx.translate(camera.x, camera.y);
            ctx.scale(camera.scale, camera.scale);
            
            drawWorld();
            
            vehicles.forEach(v => {
                v.update();
                v.draw();
            });
            
            characters.forEach(char => {
                char.update();
                char.draw();
            });
            
            updatePlayer();
            
            ctx.restore();
            camera.follow(player.vehicle || player);
            
            requestAnimationFrame(gameLoop);
        }
    </script>
</body>
</html>

