<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Battle Royale Game</title>
    <style>
        body, html { margin: 0; padding: 0; overflow: hidden; }
        canvas { display: block; }
        #menu { position: absolute; left: 10px; top: 10px; background: rgba(0,0,0,0.7); color: white; padding: 10px; }
        #mainMenu { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; background: rgba(0, 0, 0, 0.7); padding: 20px; border-radius: 10px; }
        #mainMenu h1 { color: white; }
        #mainMenu button { display: block; width: 200px; padding: 10px; margin: 10px auto; font-size: 18px; cursor: pointer; }
    </style>
</head>
<body>
    <div id="mainMenu">
        <h1>Battle Royale Game</h1>
        <button id="startButton">Start Game</button>
    </div>
    <div id="menu" style="display:none;">
        <h3>Choose Weapon</h3>
        <select id="weaponSelect"></select>
        <div id="weaponPreview" style="width:100px;height:100px;background:#444;"></div>
        <input id="username" placeholder="Enter username">
        <button id="startGame">Start Game</button>
    </div>
    <canvas id="gameCanvas"></canvas>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const map = {
            width: 4000,
            height: 3000,
            roadWidth: 200,
            buildings: [],
            doors: []
        };

        const player = {
            x: 400, y: 300, width: 30, height: 30, speed: 3, angle: 0,
            inVehicle: null, inBuilding: null, gun: null, ammo: 400,
            magazineSize: 10, magazineAmmo: 10, username: "Player",
            health: 100
        };

        const vehicles = [];
        const bullets = [];
        const camera = { x: 0, y: 0 };

        const vehicleTypes = [
            { type:'car', width:50, height:30, speed:4, color:'#4286f4', capacity:2 },
            { type:'truck', width:70, height:40, speed:3, color:'#41f468', capacity:2 }
        ];

        const guns = [
            { name:'pistol', color:'#8B4513', length :40 , image:'pistol.png', displayImage:'pistolD.png', bulletCount :1 , damage :2 },
            { name:'shotgun', color:'#A0522D', length :50 , image:'shotgun.png', displayImage:'shotgunD.png', bulletCount :4 , damage :5 },
            { name:'rifle', color:'#D2691E', length :60 , image:'rifle.png', displayImage:'rifleD.png', bulletCount :1 , damage :3 }
        ];

        const playerImage = new Image();
        playerImage.src = 'player.png';

        const aiPlayers = [];
        
        for (let e = 0; e < 10; e++) {
            aiPlayers.push({
                x: Math.random() * map.width,
                y: Math.random() * map.height,
                width: 40,
                height: 40,
                speed: 2,
                angle: Math.random() * Math.PI * 2,
                inVehicle:null,
                inBuilding:null,
                gun:guns[Math.floor(Math.random() * guns.length)],
                ammo :400,
                magazineSize :10,
                magazineAmmo :10,
                state:"wandering",
                target:null,
                targetTimer :0,
                username:"AI_"+e,
                health :100
            });
        }

       for (let e=0;e<20;e++) {
           const n={
               x :Math.random() * map.width,
               y :Math.random() * map.height,
               width :200 + (200 * Math.random()),
               height :200 + (200 * Math.random()),
               interior:{color:"#D2B48C"}
           };
           
           let t=false;
           
           for (const a of map.buildings) if (checkCollision(n,a)) {
               t=true;
               break;
           }
           
           if (!t) {
               map.buildings.push(n);
               map.doors.push({x:n.x+n.width/2,y:n.y+n.height,width :40,height :60,isOpen:false,openAngle :0});
           }
       }

       for (let e=0;e<4;e++) {
           const n=vehicleTypes[Math.floor(Math.random()*vehicleTypes.length)];
           
           vehicles.push({
               ...n,
               x: Math.random() * map.width,
               y: Math.random() * map.height,
               angle: Math.random() * Math.PI * 2,
               steeringAngle: 0,
               maxSteeringAngle: Math.PI / 4,
               driver:null,
               passenger:null
           });
       }

       function drawMap(){
           ctx.fillStyle="#7CFC00";
           ctx.fillRect(0,0,canvas.width,canvas.height);
           ctx.fillStyle="#8B4513";
           ctx.fillRect(map.width/2-map.roadWidth/2-camera.x,0,map.roadWidth,canvas.height);
           ctx.fillRect(0,map.height/2-map.roadWidth/2-camera.y,canvas.width,map.roadWidth);
           ctx.fillStyle="#808080";
           map.buildings.forEach(e => {
               ctx.fillRect(e.x-camera.x,e.y-camera.y,e.width,e.height);
               if(player.inBuilding === e) {
                   ctx.fillStyle=e.interior.color;
                   ctx.fillRect(e.x-camera.x,e.y-camera.y,e.width,e.height);
                   ctx.fillStyle="#808080";
               }
           });
           ctx.fillStyle="#8B4513";
           map.doors.forEach(e => {
               ctx.save();
               ctx.translate(e.x-camera.x,e.y-camera.y);
               ctx.rotate(e.openAngle);
               ctx.fillRect(-e.width/2,0,e.width,e.height);
               ctx.restore();
           });
       }

       function drawPlayer(p,inVehicle=false,v=null){
           ctx.save();
           inVehicle ? ctx.translate(v.x-camera.x,v.y-camera.y) : ctx.translate(p.x-camera.x,p.y-camera.y);
           ctx.rotate(p.angle + Math.PI / 2);
           ctx.drawImage(playerImage,-p.width/2,-p.height/2,p.width,p.height);
           if (p.gun) {
               ctx.drawImage(gunImages[p.gun.name], p.width / 2 - p.gun.length / 4 -5 , -p.height /4 - p.gun.length /8 , p.gun.length +20 , p.gun.length /4);
           }
           ctx.restore();
       }

       function drawHUD(){
           ctx.fillStyle="#000000";
           ctx.font="20px Arial";
           ctx.fillText(`Health:${player.health}`,10 ,30 );
           ctx.fillText(`Gun:${player.gun ? player.gun.name : "None"}`,10 ,60 );
           ctx.fillText(`Ammo:${player.magazineAmmo}/${player.ammo}`,10 ,90 );
       }

       function checkCollision(a,b){
           return a.x<b.x+b.width && a.x+a.width>b.x && a.y<b.y+b.height && a.y+a.height>b.y;
       }

       function updateAI(ai){
          // AI behavior logic here
          // Similar to previous implementations
       }

       function update(){
          // Update player and AI positions
          // Handle input and game logic
       }

       function render(){
          // Clear the canvas and draw everything
          ctx.clearRect(0,0,canvas.width,canvas.height);
          drawMap();
          vehicles.forEach(drawVehicle);
          aiPlayers.forEach(ai => drawPlayer(ai));
          drawPlayer(player);
          drawHUD();
       }

       function gameLoop(){
          update();
          render();
          requestAnimationFrame(gameLoop);
       }

       document.getElementById("startButton").addEventListener("click", () => {
          document.getElementById("mainMenu").style.display = "none";
          document.getElementById("menu").style.display = "block";
          gameLoop();
       });

      // Initialize weapon selection
      const weaponSelect = document.getElementById("weaponSelect");
      guns.forEach(gun => {
          const option = document.createElement("option");
          option.value = gun.name;
          option.textContent = gun.name;
          weaponSelect.appendChild(option);
      });

      weaponSelect.addEventListener("change", () => {
          const selectedGun = guns.find(g => g.name === weaponSelect.value);
          document.getElementById("weaponPreview").style.backgroundImage = `url(${selectedGun.displayImage})`;
      });

      document.getElementById("startGame").addEventListener("click", () => {
          player.gun = guns.find(g => g.name === weaponSelect.value);
          player.username = document.getElementById("username").value || "Player";
          document.getElementById("menu").style.display = "none";
      });

    </script>
</body>
</html>
