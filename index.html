<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Battle Royale Game</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        #gameCanvas {
            border: 2px solid #666;
            background: #8fbc8f;
        }
        #menu {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            color: white;
            text-align: center;
            display: none;
        }
        .hud {
            position: absolute;
            bottom: 20px;
            left: 20px;
            color: white;
            font-family: Arial;
            text-shadow: 2px 2px black;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <div id="menu">
        <h2>Battle Royale</h2>
        <button onclick="startGame()">Start Game</button>
        <select id="weaponSelect">
            <option value="pistol">Pistol</option>
            <option value="shotgun">Shotgun</option>
            <option value="rifle">Rifle</option>
            <option value="auto">Auto Shotgun</option>
        </select>
    </div>
    <div class="hud">
        <div id="health">Health: 100</div>
        <div id="ammo">Ammo: 30</div>
        <div id="weapon">Weapon: Pistol</div>
    </div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

// Game constants
const PLAYER_SPEED = 5;
const BULLET_SPEED = 10;
const AI_COUNT = 10;

// Game state
let gameRunning = false;
let player = {
    x: 100,
    y: 100,
    width: 30,
    height: 30,
    health: 100,
    speed: PLAYER_SPEED,
    weapon: 'pistol',
    ammo: 30,
    color: '#ff0000'
};

let buildings = [];
let vehicles = [];
let bullets = [];
let aiPlayers = [];
let keys = {};

// Initialize game
function init() {
    canvas.width = window.innerWidth - 40;
    canvas.height = window.innerHeight - 40;
    
    // Generate buildings
    for(let i = 0; i < 20; i++) {
        buildings.push({
            x: Math.random() * canvas.width,
            y: Math.random() * canvas.height,
            width: Math.random() * 100 + 50,
            height: Math.random() * 100 + 50
        });
    }
    
    // Generate vehicles
    for(let i = 0; i < 5; i++) {
        vehicles.push({
            x: Math.random() * canvas.width,
            y: Math.random() * canvas.height,
            width: 40,
            height: 60,
            speed: 0,
            rotation: 0
        });
    }
    
    // Generate AI players
    for(let i = 0; i < AI_COUNT; i++) {
        aiPlayers.push({
            x: Math.random() * canvas.width,
            y: Math.random() * canvas.height,
            width: 30,
            height: 30,
            health: 100,
            speed: PLAYER_SPEED * 0.7,
            direction: Math.random() * Math.PI * 2,
            color: '#0000ff'
        });
    }
}

// Main game loop
function gameLoop() {
    if(!gameRunning) return;
    
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    updatePlayer();
    updateAI();
    updateBullets();
    
    drawMap();
    drawBuildings();
    drawVehicles();
    drawPlayer();
    drawAI();
    drawBullets();
    
    updateHUD();
    
    requestAnimationFrame(gameLoop);
}

// Player movement
function updatePlayer() {
    if(keys['w']) player.y -= player.speed;
    if(keys['s']) player.y += player.speed;
    if(keys['a']) player.x -= player.speed;
    if(keys['d']) player.x += player.speed;
    
    // Collision detection with buildings
    buildings.forEach(building => {
        if(checkCollision(player, building)) {
            resolveCollision(player, building);
        }
    });
}

// Basic collision detection
function checkCollision(rect1, rect2) {
    return rect1.x < rect2.x + rect2.width &&
           rect1.x + rect1.width > rect2.x &&
           rect1.y < rect2.y + rect2.height &&
           rect1.y + rect1.height > rect2.y;
}

// Resolve collision by pushing objects apart
function resolveCollision(rect1, rect2) {
    const overlapX = (rect1.width + rect2.width) / 2 - Math.abs(rect1.x - rect2.x);
    const overlapY = (rect1.height + rect2.height) / 2 - Math.abs(rect1.y - rect2.y);
    
    if(overlapX < overlapY) {
        if(rect1.x < rect2.x) rect1.x -= overlapX;
        else rect1.x += overlapX;
    } else {
        if(rect1.y < rect2.y) rect1.y -= overlapY;
        else rect1.y += overlapY;
    }
}

// Draw functions
function drawMap() {
    ctx.fillStyle = '#8fbc8f';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
}

function drawBuildings() {
    ctx.fillStyle = '#808080';
    buildings.forEach(building => {
        ctx.fillRect(building.x, building.y, building.width, building.height);
    });
}

function drawVehicles() {
    ctx.fillStyle = '#404040';
    vehicles.forEach(vehicle => {
        ctx.save();
        ctx.translate(vehicle.x + vehicle.width/2, vehicle.y + vehicle.height/2);
        ctx.rotate(vehicle.rotation);
        ctx.fillRect(-vehicle.width/2, -vehicle.height/2, vehicle.width, vehicle.height);
        ctx.restore();
    });
}

function drawPlayer() {
    ctx.fillStyle = player.color;
    ctx.fillRect(player.x, player.y, player.width, player.height);
}

function drawAI() {
    aiPlayers.forEach(ai => {
        ctx.fillStyle = ai.color;
        ctx.fillRect(ai.x, ai.y, ai.width, ai.height);
    });
}

function drawBullets() {
    ctx.fillStyle = '#ffff00';
    bullets.forEach(bullet => {
        ctx.beginPath();
        ctx.arc(bullet.x, bullet.y, 3, 0, Math.PI * 2);
        ctx.fill();
    });
}

// Event listeners
window.addEventListener('keydown', e => keys[e.key] = true);
window.addEventListener('keyup', e => keys[e.key] = false);
window.addEventListener('resize', () => {
    canvas.width = window.innerWidth - 40;
    canvas.height = window.innerHeight - 40;
});

canvas.addEventListener('click', e => {
    if(!gameRunning) return;
    
    const angle = Math.atan2(e.clientY - player.y, e.clientX - player.x);
    bullets.push({
        x: player.x + player.width/2,
        y: player.y + player.height/2,
        speed: BULLET_SPEED,
        angle: angle,
        damage: getWeaponDamage(player.weapon)
    });
});

function getWeaponDamage(weapon) {
    const damages = {
        pistol: 10,
        shotgun: 25,
        rifle: 15,
        auto: 20
    };
    return damages[weapon] || 10;
}

function updateHUD() {
    document.getElementById('health').textContent = `Health: ${player.health}`;
    document.getElementById('ammo').textContent = `Ammo: ${player.ammo}`;
    document.getElementById('weapon').textContent = `Weapon: ${player.weapon}`;
}

function startGame() {
    player.weapon = document.getElementById('weaponSelect').value;
    document.getElementById('menu').style.display = 'none';
    gameRunning = true;
    init();
    gameLoop();
}

// Show menu on load
document.getElementById('menu').style.display = 'block';
</script>
</body>
</html>
