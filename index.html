<!DOCTYPE html>
<html>
<head>
    <title>Battle Royale</title>
    <style>
        * { margin: 0; padding: 0; overflow: hidden; }
        canvas { display: block; background: #90EE90; }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const WORLD_WIDTH = 5000;
        const WORLD_HEIGHT = 5000;

        const camera = {
            x: 0,
            y: 0,
            follow(target) {
                this.x = -target.x + canvas.width/2;
                this.y = -target.y + canvas.height/2;
            }
        };

        class Character {
            constructor(x, y, team = 'neutral') {
                this.x = x;
                this.y = y;
                this.rotation = 0;
                this.speed = 4;
                this.health = 100;
                this.team = team;
                this.vehicle = null;
                this.target = null;
                this.state = 'wandering';
                this.color = this.getTeamColor();
                this.isAI = true;
            }

            getTeamColor() {
                return {
                    'red': '#ff4444',
                    'blue': '#4444ff',
                    'green': '#44ff44',
                    'neutral': '#aaaaaa',
                    'player': '#ffff44'
                }[this.team] || '#aaaaaa';
            }

            draw() {
                if (this.vehicle) return;
                
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(this.rotation);

                // Health bar
                ctx.fillStyle = '#ff0000';
                ctx.fillRect(-40, -60, 80, 10);
                ctx.fillStyle = '#00ff00';
                ctx.fillRect(-40, -60, 80 * (this.health/100), 10);
                
                // Body
                ctx.beginPath();
                ctx.arc(0, 0, 40, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                ctx.fill();
                
                // Arms
                ctx.fillRect(30, -20, 20, 20);
                ctx.fillRect(30, 0, 20, 20);
                
                ctx.restore();
            }

            update() {
                if (this.health <= 0) return;

                if (this.isAI) {
                    if (!this.vehicle) {
                        if (!this.target || this.reachedTarget()) {
                            this.target = {
                                x: Math.random() * WORLD_WIDTH,
                                y: Math.random() * WORLD_HEIGHT
                            };
                        }
                        
                        const dx = this.target.x - this.x;
                        const dy = this.target.y - this.y;
                        this.rotation = Math.atan2(dy, dx);
                        
                        this.x += Math.cos(this.rotation) * this.speed;
                        this.y += Math.sin(this.rotation) * this.speed;

                        if (Math.random() < 0.01) {
                            vehicles.forEach(v => {
                                if (!v.driver && Math.hypot(v.x - this.x, v.y - this.y) < 50) {
                                    this.vehicle = v;
                                    v.driver = this;
                                }
                            });
                        }
                    } else {
                        if (Math.random() < 0.005) {
                            this.vehicle.driver = null;
                            this.vehicle = null;
                        }
                    }
                }

                // Keep in world bounds
                this.x = Math.max(0, Math.min(WORLD_WIDTH, this.x));
                this.y = Math.max(0, Math.min(WORLD_HEIGHT, this.y));
            }

            reachedTarget() {
                return Math.hypot(this.target.x - this.x, this.target.y - this.y) < 50;
            }
        }

        class Vehicle {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.width = 160;
                this.height = 80;
                this.wheelBase = 80;
                this.wheelAngle = 0;
                this.maxWheelAngle = Math.PI/4;
                this.rotation = 0;
                this.speed = 0;
                this.maxSpeed = 8;
                this.acceleration = 0.2;
                this.friction = 0.98;
                this.driver = null;
            }

            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(this.rotation);

                // Car body
                ctx.fillStyle = '#444444';
                ctx.fillRect(-this.width/2, -this.height/2, this.width, this.height);

                // Wheels
                ctx.fillStyle = '#000';
                // Back wheels (fixed)
                ctx.fillRect(-this.width/2, -this.height/2 - 5, 20, 10);
                ctx.fillRect(-this.width/2, this.height/2, 20, 10);
                
                // Front wheels (turning)
                ctx.save();
                ctx.translate(this.width/2 - 20, -this.height/2 - 5);
                ctx.rotate(this.wheelAngle);
                ctx.fillRect(0, 0, 20, 10);
                ctx.restore();

                ctx.save();
                ctx.translate(this.width/2 - 20, this.height/2);
                ctx.rotate(this.wheelAngle);
                ctx.fillRect(0, 0, 20, 10);
                ctx.restore();

                // Draw driver
                if (this.driver) {
                    ctx.save();
                    ctx.rotate(this.rotation * -1);
                    
                    ctx.beginPath();
                    ctx.arc(0, 0, 40, 0, Math.PI * 2);
                    ctx.fillStyle = this.driver.color;
                    ctx.fill();
                    
                    ctx.fillRect(30, -20, 20, 20);
                    ctx.fillRect(30, 0, 20, 20);
                    
                    ctx.restore();
                }

                ctx.restore();
            }

            update() {
                if (this.driver) {
                    if (!this.driver.isAI) {
                        if (keys.w) this.speed = Math.min(this.maxSpeed, this.speed + this.acceleration);
                        if (keys.s) this.speed = Math.max(-this.maxSpeed/2, this.speed - this.acceleration);
                        if (keys.a) this.wheelAngle = Math.max(-this.maxWheelAngle, this.wheelAngle - 0.1);
                        if (keys.d) this.wheelAngle = Math.min(this.maxWheelAngle, this.wheelAngle + 0.1);
                        if (!keys.a && !keys.d) this.wheelAngle *= 0.5;
                    } else {
                        this.speed = 3;
                        this.wheelAngle = Math.sin(Date.now() / 1000) * this.maxWheelAngle;
                    }

                    this.speed *= this.friction;

                    if (Math.abs(this.speed) > 0.1) {
                        const turnRadius = this.wheelBase / Math.sin(this.wheelAngle || 0.0001);
                        this.rotation += this.speed / turnRadius;
                    }

                    this.x += Math.cos(this.rotation) * this.speed;
                    this.y += Math.sin(this.rotation) * this.speed;

                    // Keep in world bounds
                    this.x = Math.max(this.width/2, Math.min(WORLD_WIDTH - this.width/2, this.x));
                    this.y = Math.max(this.height/2, Math.min(WORLD_HEIGHT - this.height/2, this.y));
                }
            }
        }

        const player = new Character(WORLD_WIDTH/2, WORLD_HEIGHT/2, 'player');
        player.isAI = false;

        const vehicles = Array(20).fill().map(() => new Vehicle(
            Math.random() * (WORLD_WIDTH - 400) + 200,
            Math.random() * (WORLD_HEIGHT - 400) + 200
        ));

        const characters = [
            player,
            ...Array(10).fill().map(() => new Character(
                Math.random() * WORLD_WIDTH,
                Math.random() * WORLD_HEIGHT,
                ['red', 'blue', 'green'][Math.floor(Math.random() * 3)]
            ))
        ];

        const keys = {w: false, s: false, a: false, d: false, e: false};
        let mouseX = 0, mouseY = 0;

        window.addEventListener('keydown', e => keys[e.key] = true);
        window.addEventListener('keyup', e => keys[e.key] = false);
        window.addEventListener('mousemove', e => {
            mouseX = e.clientX - camera.x;
            mouseY = e.clientY - camera.y;
        });

        function updatePlayer() {
            if (!player.vehicle) {
                if (keys.w) player.y -= player.speed;
                if (keys.s) player.y += player.speed;
                if (keys.a) player.x -= player.speed;
                if (keys.d) player.x += player.speed;
                
                const dx = mouseX - player.x;
                const dy = mouseY - player.y;
                player.rotation = Math.atan2(dy, dx);

                if (keys.e) {
                    vehicles.forEach(v => {
                        if (!v.driver && Math.hypot(v.x - player.x, v.y - player.y) < 50) {
                            player.vehicle = v;
                            v.driver = player;
                        }
                    });
                }
            } else {
                player.rotation = player.vehicle.rotation;
                if (keys.e) {
                    player.x = player.vehicle.x;
                    player.y = player.vehicle.y;
                    player.vehicle.driver = null;
                    player.vehicle = null;
                }
            }
        }

        function drawWorld() {
            // Background grid
            ctx.strokeStyle = '#80DD80';
            for(let i = 0; i < WORLD_WIDTH; i += 200) {
                ctx.beginPath();
                ctx.moveTo(i, 0);
                ctx.lineTo(i, WORLD_HEIGHT);
                ctx.stroke();
            }
            for(let i = 0; i < WORLD_HEIGHT; i += 200) {
                ctx.beginPath();
                ctx.moveTo(0, i);
                ctx.lineTo(WORLD_WIDTH, i);
                ctx.stroke();
            }
        }

        function gameLoop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            ctx.save();
            ctx.translate(camera.x, camera.y);
            
            drawWorld();
            
            vehicles.forEach(v => {
                v.update();
                v.draw();
            });
            
            characters.forEach(char => {
                char.update();
                char.draw();
            });
            
            updatePlayer();
            
            ctx.restore();
            camera.follow(player.vehicle || player);
            
            requestAnimationFrame(gameLoop);
        }

        gameLoop();
    </script>
</body>
</html>
