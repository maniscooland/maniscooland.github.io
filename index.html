<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Battle Royale Game</title><style>body,html{margin:0;padding:0;overflow:hidden}canvas{display:block}#menu{position:absolute;left:10px;top:10px;background:rgba(0,0,0,0.7);color:white;padding:10px}#weaponPreview{width:100px;height:100px;background:#444}</style></head><body><div id="menu"><h3>Choose Weapon</h3><select id="weaponSelect"></select><div id="weaponPreview"></div><input id="username" placeholder="Enter username"><button id="startGame">Start Game</button></div><canvas id="gameCanvas"></canvas><script>
const canvas=document.getElementById("gameCanvas"),ctx=canvas.getContext("2d");canvas.width=window.innerWidth,canvas.height=window.innerHeight;const map={width:4e3,height:3e3,roadWidth:200,buildings:[],doors:[]},player={x:400,y:300,width:40,height:40,speed:3,angle:0,inVehicle:null,inBuilding:null,gun:null,ammo:400,magazineSize:10,magazineAmmo:10,username:"Player"},vehicles=[],bullets=[],camera={x:0,y:0},vehicleTypes=[{type:"car",width:50,height:30,speed:4,color:"#4286f4",capacity:2},{type:"truck",width:70,height:40,speed:3,color:"#41f468",capacity:2}],guns=[{name:"pistol",color:"#8B4513",length:20,image:"pistol.png",bulletCount:1},{name:"shotgun",color:"#A0522D",length:30,image:"shotgun.png",bulletCount:4},{name:"rifle",color:"#D2691E",length:40,image:"rifle.png",bulletCount:1}],playerImage=new Image;playerImage.src="player.png";const aiPlayers=[];for(let e=0;e<10;e++)aiPlayers.push({x:Math.random()*map.width,y:Math.random()*map.height,width:40,height:40,speed:2,angle:2*Math.random()*Math.PI,inVehicle:null,inBuilding:null,gun:guns[Math.floor(Math.random()*guns.length)],ammo:400,magazineSize:10,magazineAmmo:10,state:"wandering",target:null,targetTimer:0,username:"AI_"+e});for(let e=0;e<20;e++){const t={x:Math.random()*map.width,y:Math.random()*map.height,width:200+200*Math.random(),height:200+200*Math.random(),interior:{color:"#D2B48C"}};let a=!1;for(const n of map.buildings)if(checkCollision(t,n)){a=!0;break}a||(map.buildings.push(t),map.doors.push({x:t.x+t.width/2,y:t.y+t.height,width:40,height:60,isOpen:!1,openAngle:0}))}for(let e=0;e<4;e++){const t=vehicleTypes[Math.floor(Math.random()*vehicleTypes.length)];vehicles.push({...t,x:Math.random()*map.width,y:Math.random()*map.height,angle:2*Math.random()*Math.PI,steeringAngle:0,maxSteeringAngle:Math.PI/4,driver:null,passenger:null})}function drawMap(){ctx.fillStyle="#7CFC00",ctx.fillRect(0,0,canvas.width,canvas.height),ctx.fillStyle="#8B4513",ctx.fillRect(map.width/2-map.roadWidth/2-camera.x,0,map.roadWidth,canvas.height),ctx.fillRect(0,map.height/2-map.roadWidth/2-camera.y,canvas.width,map.roadWidth),ctx.fillStyle="#808080",map.buildings.forEach(e=>{ctx.fillRect(e.x-camera.x,e.y-camera.y,e.width,e.height),player.inBuilding===e&&(ctx.fillStyle=e.interior.color,ctx.fillRect(e.x-camera.x,e.y-camera.y,e.width,e.height),ctx.fillStyle="#808080")}),ctx.fillStyle="#8B4513",map.doors.forEach(e=>{ctx.save(),ctx.translate(e.x-camera.x,e.y-camera.y),ctx.rotate(e.openAngle),ctx.fillRect(-e.width/2,0,e.width,e.height),ctx.restore()})}function drawVehicle(e){ctx.save(),ctx.translate(e.x-camera.x,e.y-camera.y),ctx.rotate(e.angle),ctx.fillStyle=e.color,ctx.fillRect(-e.width/2,-e.height/2,e.width,e.height),ctx.fillStyle="#000000",ctx.save(),ctx.translate(e.width/2-10,-e.height/2),ctx.rotate(e.steeringAngle),ctx.fillRect(-5,-5,10,10),ctx.restore(),ctx.save(),ctx.translate(e.width/2-10,e.height/2),ctx.rotate(e.steeringAngle),ctx.fillRect(-5,-5,10,10),ctx.restore(),ctx.fillRect(-e.width/2+5,-e.height/2-5,10,10),ctx.fillRect(-e.width/2+5,e.height/2-5,10,10),ctx.restore(),e.driver&&drawPlayer(e.driver,!0,e),e.passenger&&drawPlayer(e.passenger,!0,e)}function drawPlayer(e,t=!1,a=null){ctx.save(),t?ctx.translate((a.width/2-e.width/2)*(e===a.passenger?-1:1),0):ctx.translate(e.x-camera.x,e.y-camera.y),ctx.rotate(e.angle+Math.PI/2),ctx.drawImage(playerImage,-e.width/2,-e.height/2,e.width,e.height),e.gun&&(ctx.save(),ctx.translate(e.width/2,0),ctx.rotate(-Math.PI/2),ctx.fillStyle=e.gun.color,ctx.fillRect(0,-2,e.gun.length,4),ctx.restore()),ctx.fillStyle="#000",ctx.font="12px Arial",ctx.fillText(e.username,-20,30),ctx.restore()}function drawBullets(){ctx.fillStyle="#FF0000",bullets.forEach(e=>{ctx.beginPath(),ctx.arc(e.x-camera.x,e.y-camera.y,3,0,2*Math.PI),ctx.fill()})}function drawHUD(){ctx.fillStyle="#000000",ctx.font="20px Arial",ctx.fillText(`Gun: ${player.gun?player.gun.name:"None"}`,10,30),ctx.fillText(`Ammo: ${player.magazineAmmo}/${player.ammo}`,10,60)}function updateBullets(){for(let e=bullets.length-1;e>=0;e--)bullets[e].x+=10*Math.cos(bullets[e].angle),bullets[e].y+=10*Math.sin(bullets[e].angle),(bullets[e].x<0||bullets[e].x>map.width||bullets[e].y<0||bullets[e].y>map.height)&&bullets.splice(e,1)}function shoot(e){if(e.gun&&e.magazineAmmo>0){const t=e.gun.bulletCount,a=.2;for(let n=0;n<t;n++){const i=e.angle+(t>1?a*(n-(t-1)/2):0);bullets.push({x:e.x+30*Math.cos(i),y:e.y+30*Math.sin(i),angle:i})}e.magazineAmmo--}}function reload(e){if(e.gun&&e.ammo>0){const t=e.magazineSize-e.magazineAmmo,a=Math.min(t,e.ammo);e.magazineAmmo+=a,e.ammo-=a}}function checkCollision(e,t){return e.x<t.x+t.width&&e.x+e.width>t.x&&e.y<t.y+t.height&&e.y+e.height>t.y}function updateAI(e){switch(e.state){case"wandering":if(e.x+=Math.cos(e.angle)*e.speed,e.y+=Math.sin(e.angle)*e.speed,Math.random()<.02&&(e.angle=2*Math.random()*Math.PI),!e.inVehicle&&!e.inBuilding){let t=null,a=1/0;vehicles.forEach(n=>{if(n.driver&&!n.passenger||!n.driver){const i=Math.hypot(n.x-e.x,n.y-e.y);i<a&&(t=n,a=i)}}),t&&a<100&&(e.state="seeking_vehicle",e.target=t)}break;case"seeking_vehicle":const t=e.target.x-e.x,a=e.target.y-e.y;if(e.angle=Math.atan2(a,t),e.x+=Math.cos(e.angle)*e.speed,e.y+=Math.sin(e.angle)*e.speed,Math.hypot(t,a)<10){const n=e.target;n.driver?n.passenger||(n.passenger=e):n.driver=e,e.inVehicle=n,e.state="wandering",e.target=null}if(e.targetTimer++,e.targetTimer>300)e.state="wandering",e.target=null,e.targetTimer=0}e.inBuilding?(e.x=Math.max(e.inBuilding.x,Math.min(e.inBuilding.x+e.inBuilding.width-e.width,e.x)),e.y=Math.max(e.inBuilding.y,Math.min(e.inBuilding.y+e.inBuilding.height-e.height,e.y))):(map.buildings.forEach(t=>{if(checkCollision(e,t)){const a=Math.min(e.x+e.width-t.x,t.x+t.width-e.x),n=Math.min(e.y+e.height-t.y,t.y+t.height-e.y);a<n?e.x+=e.x<t.x?-a:a:e.y+=e.y<t.y?-n:n}}),e.x=Math.max(0,Math.min(map.width,e.x)),e.y=Math.max(0,Math.min(map.height,e.y))),Math.random()<.01&&shoot(e),0===e.magazineAmmo&&Math.random()<.1&&reload(e)}function update(){if(player.inVehicle){const e=player.inVehicle;keys.w&&(e.x+=Math.cos(e.angle)*e.speed,e.y+=Math.sin(e.angle)*e.speed),keys.s&&(e.x-=Math.cos(e.angle)*e.speed/2,e.y-=Math.sin(e.angle)*e.speed/2),keys.a&&(e.steeringAngle=Math.max(-e.maxSteeringAngle,e.steeringAngle-.05)),keys.d&&(e.steeringAngle=Math.min(e.maxSteeringAngle,e.steeringAngle+.05)),e.angle+=e.steeringAngle*e.speed/30,e.steeringAngle*=.9,player.x=e.x,player.y=e.y,player.angle=e.angle}else player.inBuilding?(keys.w&&(player.y-=player.speed),keys.s&&(player.y+=player.speed),keys.a&&(player.x-=player.speed),keys.d&&(player.x+=player.speed),player.x=Math.max(player.inBuilding.x,Math.min(player.inBuilding.x+player.inBuilding.width-player.width,player.x)),player.y=Math.max(player.inBuilding.y,Math.min(player.inBuilding.y+player.inBuilding.height-player.height,player.y))):(keys.w&&(player.y-=player.speed),keys.s&&(player.y+=player.speed),keys.a&&(player.x-=player.speed),keys.d&&(player.x+=player.speed));aiPlayers.forEach(updateAI),vehicles.forEach(e=>{e.driver&&(e.x+=Math.cos(e.angle)*e.speed,e.y+=Math.sin(e.angle)*e.speed,e.x=Math.max(0,Math.min(map.width,e.x)),e.y=Math.max(0,Math.min(map.height,e.y)))}),player.inBuilding||(map.buildings.forEach(e=>{if(checkCollision(player,e)){const t=Math.min(player.x+player.width-e.x,e.x+e.width-player.x),a=Math.min(player.y+player.height-e.y,e.y+e.height-player.y);t<a?player.x+=player.x<e.x?-t:t:player.y+=player.y<e.y?-a:a}}),player.x=Math.max(0,Math.min(map.width,player.x)),player.y=Math.max(0,Math.min(map.height,player.y))),map.doors.forEach(e=>{const t=Math.hypot(player.x-e.x,player.y-e.y);t<50?(e.isOpen=!0,e.openAngle=Math.min(e.openAngle+.1,Math.PI/2)):t>=50&&(e.isOpen=!1,e.openAngle=Math.max(e.openAngle-.1,0))}),keys.e&&(player.inVehicle?(player.inVehicle.driver===player?player.inVehicle.driver=null:player.inVehicle.passenger=null,player.inVehicle=null,player.x+=40*Math.cos(player.angle),player.y+=40*Math.sin(player.angle)):player.inBuilding?(player.inBuilding=null,player.y+=70):vehicles.forEach(e=>{Math.hypot(player.x-e.x,player.y-e.y)<50&&(e.driver?e.passenger||(e.passenger=player):e.driver=player,player.inVehicle=e)}),keys.e=!1),keys.f&&(player.inBuilding||(map.buildings.forEach(e=>{Math.hypot(player.x-(e.x+e.width/2),player.y-(e.y+e.height))<50&&(player.inBuilding=e,player.y-=70)}),keys.f=!1)),keys.r&&(reload(player),keys.r=!1),camera.x=player.x-canvas.width/2,camera.y=player.y
