<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Battle Dudes IO-like Game with Smooth Movement</title>
    <style>
        canvas { border: 1px solid black; }
        #keys {
            position: absolute;
            bottom: 20px;
            left: 20px;
            display: grid;
            grid-template-columns: repeat(3, 50px);
            grid-gap: 5px;
        }
        .key {
            width: 50px;
            height: 50px;
            background-color: #ddd;
            border: 2px solid #999;
            border-radius: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            font-weight: bold;
        }
        .key.active {
            background-color: #aaa;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    <div id="keys">
        <div></div>
        <div class="key" id="key-w">W</div>
        <div></div>
        <div class="key" id="key-a">A</div>
        <div class="key" id="key-s">S</div>
        <div class="key" id="key-d">D</div>
    </div>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // Player
        const player = {
            x: 400,
            y: 300,
            vx: 0,
            vy: 0,
            maxSpeed: 5,
            acceleration: 0.5,
            deceleration: 0.9,
            angle: 0,
            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(this.angle);
                
                // Body
                ctx.beginPath();
                ctx.arc(0, 0, 20, 0, Math.PI * 2);
                ctx.fillStyle = 'blue';
                ctx.fill();
                
                // Hands
                ctx.beginPath();
                ctx.moveTo(-20, -20);
                ctx.lineTo(-30, -30);
                ctx.moveTo(20, -20);
                ctx.lineTo(30, -30);
                ctx.strokeStyle = 'blue';
                ctx.stroke();
                
                ctx.restore();
            },
            update() {
                // Apply acceleration based on key presses
                if (keys['w']) this.vy -= this.acceleration;
                if (keys['s']) this.vy += this.acceleration;
                if (keys['a']) this.vx -= this.acceleration;
                if (keys['d']) this.vx += this.acceleration;

                // Apply deceleration
                this.vx *= this.deceleration;
                this.vy *= this.deceleration;

                // Limit speed
                const speed = Math.sqrt(this.vx * this.vx + this.vy * this.vy);
                if (speed > this.maxSpeed) {
                    const ratio = this.maxSpeed / speed;
                    this.vx *= ratio;
                    this.vy *= ratio;
                }

                // Update position
                this.x += this.vx;
                this.y += this.vy;

                // Keep player within canvas bounds
                this.x = Math.max(20, Math.min(canvas.width - 20, this.x));
                this.y = Math.max(20, Math.min(canvas.height - 20, this.y));
            }
        };

        // AI players
        const aiPlayers = [];
        for (let i = 0; i < 5; i++) {
            aiPlayers.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                speed: 2,
                angle: Math.random() * Math.PI * 2,
                draw() {
                    ctx.save();
                    ctx.translate(this.x, this.y);
                    ctx.rotate(this.angle);
                    
                    ctx.beginPath();
                    ctx.arc(0, 0, 20, 0, Math.PI * 2);
                    ctx.fillStyle = 'red';
                    ctx.fill();
                    
                    ctx.beginPath();
                    ctx.moveTo(-20, -20);
                    ctx.lineTo(-30, -30);
                    ctx.moveTo(20, -20);
                    ctx.lineTo(30, -30);
                    ctx.strokeStyle = 'red';
                    ctx.stroke();
                    
                    ctx.restore();
                },
                update() {
                    this.x += Math.cos(this.angle) * this.speed;
                    this.y += Math.sin(this.angle) * this.speed;
                    
                    if (this.x < 0 || this.x > canvas.width || this.y < 0 || this.y > canvas.height) {
                        this.angle = Math.random() * Math.PI * 2;
                    }
                }
            });
        }

        // Vehicles
        const vehicles = [
            { x: 200, y: 200, width: 200, height: 120, wheelAngle: 0 },
            { x: 600, y: 400, width: 200, height: 120, wheelAngle: 0 }
        ];

        function drawVehicle(vehicle) {
            ctx.save();
            ctx.translate(vehicle.x, vehicle.y);

            // Body
            ctx.fillStyle = 'gray';
            ctx.fillRect(0, 0, vehicle.width, vehicle.height);

            // Wheels
            ctx.fillStyle = 'black';
            const wheelSize = 30;
            const wheelPositions = [
                { x: 20, y: 0 },
                { x: vehicle.width - wheelSize - 20, y: 0 },
                { x: 20, y: vehicle.height - wheelSize },
                { x: vehicle.width - wheelSize - 20, y: vehicle.height - wheelSize }
            ];

            wheelPositions.forEach((pos, index) => {
                ctx.save();
                ctx.translate(pos.x + wheelSize / 2, pos.y + wheelSize / 2);
                if (index < 2) {  // Front wheels
                    ctx.rotate(vehicle.wheelAngle);
                }
                ctx.fillRect(-wheelSize / 2, -wheelSize / 2, wheelSize, wheelSize);
                ctx.restore();
            });

            // Seats
            ctx.fillStyle = 'lightblue';
            ctx.fillRect(vehicle.width / 2 - 40, 20, 40, 40);
            ctx.fillRect(vehicle.width / 2, 20, 40, 40);

            ctx.restore();
        }

        // Input handling
        const keys = {};
        document.addEventListener('keydown', (e) => {
            keys[e.key] = true;
            updateKeyDisplay(e.key, true);
        });
        document.addEventListener('keyup', (e) => {
            keys[e.key] = false;
            updateKeyDisplay(e.key, false);
        });
        
        function updateKeyDisplay(key, isActive) {
            const keyElement = document.getElementById(`key-${key}`);
            if (keyElement) {
                if (isActive) {
                    keyElement.classList.add('active');
                } else {
                    keyElement.classList.remove('active');
                }
            }
        }

        canvas.addEventListener('mousemove', (e) => {
            const rect = canvas.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;
            player.angle = Math.atan2(mouseY - player.y, mouseX - player.x);
        });

        function update() {
            player.update();
            aiPlayers.forEach(ai => ai.update());

            // Update vehicle wheel angles
            vehicles.forEach(vehicle => {
                const nearVehicle = Math.abs(player.x - vehicle.x) < 100 && Math.abs(player.y - vehicle.y) < 100;
                if (nearVehicle) {
                    if (keys['a']) vehicle.wheelAngle = -Math.PI / 6;
                    else if (keys['d']) vehicle.wheelAngle = Math.PI / 6;
                    else vehicle.wheelAngle = 0;
                } else {
                    vehicle.wheelAngle = 0;
                }
            });
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            vehicles.forEach(drawVehicle);
            player.draw();
            aiPlayers.forEach(ai => ai.draw());
        }

        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }

        gameLoop();
    </script>
</body>
</html>
