<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Battle Royale</title>
    <style>
        canvas { border: 1px solid black; }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // Player
        const player = {
            x: 400,
            y: 300,
            speed: 5,
            angle: 0,
            inVehicle: null
        };

        // AI players
        const aiPlayers = [];
        for (let i = 0; i < 10; i++) {
            aiPlayers.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                angle: Math.random() * Math.PI * 2,
                speed: 2,
                moveTimer: 0,
                moveInterval: Math.random() * 100 + 50,
                inVehicle: null,
                vehicleDirection: 1
            });
        }

        // Vehicles
        const vehicles = [];
        for (let i = 0; i < 5; i++) {
            vehicles.push({
                x: Math.random() * (canvas.width - 60),
                y: Math.random() * (canvas.height - 40),
                width: 60,
                height: 40,
                speed: 3,
                angle: 0,
                driver: null
            });
        }

        // Game loop
        function gameLoop() {
            update();
            render();
            requestAnimationFrame(gameLoop);
        }

        // Update game state
        function update() {
            if (player.inVehicle) {
                // Player is driving
                const vehicle = player.inVehicle;
                if (keys.w) {
                    vehicle.x += Math.cos(vehicle.angle) * vehicle.speed;
                    vehicle.y += Math.sin(vehicle.angle) * vehicle.speed;
                }
                if (keys.s) {
                    vehicle.x -= Math.cos(vehicle.angle) * vehicle.speed / 2;
                    vehicle.y -= Math.sin(vehicle.angle) * vehicle.speed / 2;
                }
                if (keys.a) vehicle.angle -= 0.05;
                if (keys.d) vehicle.angle += 0.05;

                // Keep vehicle in bounds
                vehicle.x = Math.max(0, Math.min(canvas.width - vehicle.width, vehicle.x));
                vehicle.y = Math.max(0, Math.min(canvas.height - vehicle.height, vehicle.y));

                player.x = vehicle.x + vehicle.width / 2;
                player.y = vehicle.y + vehicle.height / 2;
            } else {
                // Player movement on foot
                if (keys.w) player.y -= player.speed;
                if (keys.s) player.y += player.speed;
                if (keys.a) player.x -= player.speed;
                if (keys.d) player.x += player.speed;

                // Keep player in bounds
                player.x = Math.max(0, Math.min(canvas.width, player.x));
                player.y = Math.max(0, Math.min(canvas.height, player.y));
            }

            // Player rotation (always face cursor, even in vehicle)
            player.angle = Math.atan2(mouse.y - player.y, mouse.x - player.x);

            // AI movement and vehicle interaction
            aiPlayers.forEach(ai => {
                if (ai.inVehicle) {
                    // AI is driving
                    const vehicle = ai.inVehicle;
                    vehicle.x += Math.cos(vehicle.angle) * vehicle.speed * ai.vehicleDirection;
                    vehicle.y += Math.sin(vehicle.angle) * vehicle.speed * ai.vehicleDirection;

                    // Randomly change direction or go backwards
                    if (Math.random() < 0.02) {
                        vehicle.angle += (Math.random() - 0.5) * Math.PI / 4;
                    }
                    if (Math.random() < 0.01) {
                        ai.vehicleDirection *= -1; // Switch between forward and backward
                    }

                    // Keep vehicle in bounds
                    vehicle.x = Math.max(0, Math.min(canvas.width - vehicle.width, vehicle.x));
                    vehicle.y = Math.max(0, Math.min(canvas.height - vehicle.height, vehicle.y));

                    ai.x = vehicle.x + vehicle.width / 2;
                    ai.y = vehicle.y + vehicle.height / 2;
                    ai.angle = vehicle.angle; // Lock AI rotation to vehicle

                    // Randomly exit vehicle
                    if (Math.random() < 0.005) {
                        ai.inVehicle.driver = null;
                        ai.inVehicle = null;
                        ai.x = vehicle.x + vehicle.width / 2;
                        ai.y = vehicle.y + vehicle.height / 2;
                        ai.vehicleDirection = 1; // Reset direction when exiting
                    }
                } else {
                    // AI is on foot
                    ai.moveTimer++;
                    if (ai.moveTimer >= ai.moveInterval) {
                        ai.angle = Math.random() * Math.PI * 2;
                        ai.moveTimer = 0;
                        ai.moveInterval = Math.random() * 100 + 50;
                    }

                    ai.x += Math.cos(ai.angle) * ai.speed;
                    ai.y += Math.sin(ai.angle) * ai.speed;

                    // Keep AI in bounds
                    ai.x = Math.max(0, Math.min(canvas.width, ai.x));
                    ai.y = Math.max(0, Math.min(canvas.height, ai.y));

                    // Check for nearby vehicles to enter
                    vehicles.forEach(vehicle => {
                        if (!vehicle.driver && Math.hypot(vehicle.x + vehicle.width/2 - ai.x, vehicle.y + vehicle.height/2 - ai.y) < 30) {
                            vehicle.driver = ai;
                            ai.inVehicle = vehicle;
                            ai.vehicleDirection = 1; // Start moving forward when entering
                        }
                    });
                }
            });
        }

        // Render game objects
        function render() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Draw vehicles
            vehicles.forEach(vehicle => {
                ctx.save();
                ctx.translate(vehicle.x + vehicle.width/2, vehicle.y + vehicle.height/2);
                ctx.rotate(vehicle.angle);
                ctx.fillStyle = 'gray';
                ctx.fillRect(-vehicle.width/2, -vehicle.height/2, vehicle.width, vehicle.height);
                ctx.fillStyle = 'black';
                ctx.fillRect(-vehicle.width/2, -vehicle.height/2, 10, 10);
                ctx.fillRect(vehicle.width/2 - 10, -vehicle.height/2, 10, 10);
                ctx.fillRect(-vehicle.width/2, vehicle.height/2 - 10, 10, 10);
                ctx.fillRect(vehicle.width/2 - 10, vehicle.height/2 - 10, 10, 10);
                ctx.fillStyle = 'lightblue';
                ctx.fillRect(-10, -15, 20, 30);
                ctx.restore();

                if (vehicle.driver && vehicle.driver !== player) {
                    drawCharacter(vehicle.x + vehicle.width/2, vehicle.y + vehicle.height/2, vehicle.angle, 'red');
                }
            });

            // Draw AI players
            aiPlayers.forEach(ai => {
                if (!ai.inVehicle) {
                    drawCharacter(ai.x, ai.y, ai.angle, 'red');
                }
            });

            // Draw player
            drawCharacter(player.x, player.y, player.angle, 'blue');
        }

        function drawCharacter(x, y, angle, color) {
            ctx.save();
            ctx.translate(x, y);
            ctx.rotate(angle);
            ctx.beginPath();
            ctx.arc(0, 0, 10, 0, Math.PI * 2);
            ctx.fillStyle = color;
            ctx.fill();
            ctx.fillRect(0, -15, 3, 15);  // Right hand
            ctx.fillRect(-3, -15, 3, 15); // Left hand
            ctx.restore();
        }

        // Input handling
        const keys = {};
        const mouse = { x: 0, y: 0 };

        window.addEventListener('keydown', e => {
            keys[e.key] = true;
            if (e.key === 'e') {
                if (player.inVehicle) {
                    // Exit vehicle
                    player.inVehicle.driver = null;
                    player.inVehicle = null;
                } else {
                    // Try to enter a vehicle
                    vehicles.forEach(vehicle => {
                        if (!vehicle.driver && Math.hypot(vehicle.x + vehicle.width/2 - player.x, vehicle.y + vehicle.height/2 - player.y) < 30) {
                            vehicle.driver = player;
                            player.inVehicle = vehicle;
                        }
                    });
                }
            }
        });
        window.addEventListener('keyup', e => keys[e.key] = false);
        canvas.addEventListener('mousemove', e => {
            const rect = canvas.getBoundingClientRect();
            mouse.x = e.clientX - rect.left;
            mouse.y = e.clientY - rect.top;
        });

        // Start the game
        gameLoop();
    </script>
</body>
</html>
