<!DOCTYPE html>
<html>
<head>
    <title>Battle Game</title>
    <style>
        canvas {
            border: 1px solid black;
            background: #eee;
        }
        body { 
            margin: 0; 
            overflow: hidden; 
            cursor: crosshair;
        }
        .glove-indicator {
            position: fixed;
            bottom: 20px;
            padding: 10px;
            background: rgba(0,0,0,0.5);
            color: white;
            font-family: Arial, sans-serif;
            border-radius: 5px;
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 1000;
        }
        .glove-icon {
            width: 32px;
            height: 32px;
            object-fit: contain;
        }
        #ga1 { left: 20px; }
        #ga2 { right: 20px; }
    </style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<img id="ga1Image" src="ga1.png" style="display: none;">
<img id="ga2Image" src="ga2.png" style="display: none;">
<div id="ga1" class="glove-indicator">
    <img src="ga1.png" class="glove-icon">
    <span>100%</span>
</div>
<div id="ga2" class="glove-indicator">
    <img src="ga2.png" class="glove-icon">
    <span>100%</span>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const ga1Image = document.getElementById('ga1Image');
const ga2Image = document.getElementById('ga2Image');

let mouseX = 0;
let mouseY = 0;

function resizeCanvas() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
resizeCanvas();
window.addEventListener('resize', resizeCanvas);

class Vehicle {
     constructor(x, y, color) {
        this.x = x;
        this.y = y;
        this.radius = 20;
        this.color = color;
        this.speed = 5;
        this.bullets = [];
        this.health = 100;
        this.leftGlove = new Glove('left');
        this.rightGlove = new Glove('right');
        this.vehicle = null;
        this.angle = 0;
    }

    draw() {
        ctx.save();
        ctx.translate(this.x, this.y);
        ctx.rotate(this.angle);
        
        if (!this.vehicle) {
            // Player body
            ctx.beginPath();
            ctx.arc(0, 0, this.radius, 0, Math.PI * 2);
            ctx.fillStyle = this.color;
            ctx.fill();
            ctx.closePath();
            
            // Draw gloves as hands
            const gloveSize = 24;
            // Left glove
            ctx.drawImage(ga1Image, -this.radius - gloveSize, -gloveSize/2, gloveSize, gloveSize);
            // Right glove
            ctx.drawImage(ga2Image, this.radius, -gloveSize/2, gloveSize, gloveSize);
        }
        
        ctx.restore();

        // Health bar
        ctx.fillStyle = 'red';
        ctx.fillRect(this.x - 25, this.y - 30, 50, 5);
        ctx.fillStyle = 'green';
        ctx.fillRect(this.x - 25, this.y - 30, this.health / 2, 5);
    }

}

class Glove {
    constructor(side) {
        this.side = side;
        this.power = 100;
        this.rechargeRate = 0.5;
        this.active = false;
        this.damage = side === 'left' ? 20 : 25;
        this.range = side === 'left' ? 100 : 80;
        this.image = side === 'left' ? ga1Image : ga2Image;
    }

    use() {
        if (this.power > 0) {
            this.power -= 2;
            this.active = true;
            return true;
        }
        this.active = false;
        return false;
    }

    recharge() {
        if (this.power < 100 && !this.active) {
            this.power += this.rechargeRate;
        }
    }

    draw(x, y, angle) {
        if (this.active) {
            ctx.save();
            ctx.translate(x, y);
            ctx.rotate(angle);
            ctx.drawImage(this.image, this.side === 'left' ? -40 : 20, -16, 32, 32);
            ctx.restore();
        }
    }
}

class Bullet {
    constructor(x, y, angle, damage = 10, speed = 10) {
        this.x = x;
        this.y = y;
        this.speed = speed;
        this.angle = angle;
        this.radius = 5;
        this.damage = damage;
    }

    update() {
        this.x += Math.cos(this.angle) * this.speed;
        this.y += Math.sin(this.angle) * this.speed;
    }

    draw() {
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
        ctx.fillStyle = 'black';
        ctx.fill();
        ctx.closePath();
    }
}

class Player {
    constructor(x, y, color) {
        this.x = x;
        this.y = y;
        this.radius = 20;
        this.color = color;
        this.speed = 5;
        this.bullets = [];
        this.health = 100;
        this.leftGlove = new Glove('left');
        this.rightGlove = new Glove('right');
        this.vehicle = null;
        this.angle = 0;
    }

    draw() {
        ctx.save();
        ctx.translate(this.x, this.y);
        ctx.rotate(this.angle);
        
        if (!this.vehicle) {
            // Player body
            ctx.beginPath();
            ctx.arc(0, 0, this.radius, 0, Math.PI * 2);
            ctx.fillStyle = this.color;
            ctx.fill();
            ctx.closePath();
            
            // Direction indicator
            ctx.beginPath();
            ctx.moveTo(0, 0);
            ctx.lineTo(this.radius + 10, 0);
            ctx.strokeStyle = 'black';
            ctx.lineWidth = 3;
            ctx.stroke();
        }
        
        ctx.restore();

        // Draw gloves
        this.leftGlove.draw(this.x, this.y, this.angle);
        this.rightGlove.draw(this.x, this.y, this.angle);

        // Health bar
        ctx.fillStyle = 'red';
        ctx.fillRect(this.x - 25, this.y - 30, 50, 5);
        ctx.fillStyle = 'green';
        ctx.fillRect(this.x - 25, this.y - 30, this.health / 2, 5);
    }

    updateAngle() {
        this.angle = Math.atan2(mouseY - this.y, mouseX - this.x);
        if (this.vehicle) {
            this.vehicle.angle = this.angle;
        }
    }

    shoot() {
        const damage = this.vehicle ? this.vehicle.bulletDamage : 10;
        const bulletSpeed = this.vehicle ? (this.vehicle.type === 'tank' ? 15 : 12) : 10;
        this.bullets.push(new Bullet(this.x, this.y, this.angle, damage, bulletSpeed));
    }

    enterVehicle(vehicle) {
        if (!vehicle.occupied && !this.vehicle) {
            this.vehicle = vehicle;
            vehicle.occupied = true;
        }
    }

    exitVehicle() {
        if (this.vehicle) {
            this.vehicle.occupied = false;
            this.x = this.vehicle.x + this.vehicle.width;
            this.y = this.vehicle.y;
            this.vehicle = null;
        }
    }
}

const player = new Player(canvas.width/2, canvas.height/2, 'blue');
const enemies = [
    new Player(100, 100, 'red'),
    new Player(canvas.width-100, canvas.height-100, 'red')
];
const vehicles = [
    new Vehicle(200, 200, 'tank'),
    new Vehicle(400, 400, 'jeep'),
    new Vehicle(600, 300, 'tank')
];

const keys = {};
window.addEventListener('keydown', e => {
    keys[e.key] = true;
    if (e.key === 'e') {
        vehicles.forEach(vehicle => {
            const dx = player.x - vehicle.x;
            const dy = player.y - vehicle.y;
            const distance = Math.sqrt(dx * dx + dy * dy);
            if (distance < 50) {
                player.enterVehicle(vehicle);
            }
        });
    }
    if (e.key === 'q') {
        player.exitVehicle();
    }
});
window.addEventListener('keyup', e => keys[e.key] = false);

canvas.addEventListener('mousemove', e => {
    mouseX = e.clientX;
    mouseY = e.clientY;
});

canvas.addEventListener('click', e => {
    player.shoot();
});

function gameLoop() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    player.updateAngle();
    
    let moveX = 0;
    let moveY = 0;
    if(keys['w'] || keys['ArrowUp']) moveY -= 1;
    if(keys['s'] || keys['ArrowDown']) moveY += 1;
    if(keys['a'] || keys['ArrowLeft']) moveX -= 1;
    if(keys['d'] || keys['ArrowRight']) moveX += 1;

    if (moveX !== 0 && moveY !== 0) {
        moveX *= 0.707;
        moveY *= 0.707;
    }

    const currentSpeed = player.vehicle ? player.vehicle.speed : player.speed;
    
    if (player.vehicle) {
        player.vehicle.x += moveX * currentSpeed;
        player.vehicle.y += moveY * currentSpeed;
        player.x = player.vehicle.x;
        player.y = player.vehicle.y;
    } else {
        player.x += moveX * currentSpeed;
        player.y += moveY * currentSpeed;
    }

    if (keys['f']) player.leftGlove.use();
    if (keys['g']) player.rightGlove.use();

    document.querySelector('#ga1 span').textContent = `${Math.round(player.leftGlove.power)}%`;
    document.querySelector('#ga2 span').textContent = `${Math.round(player.rightGlove.power)}%`;

    player.leftGlove.recharge();
    player.rightGlove.recharge();

    const boundaryCheck = (entity) => {
        const radius = entity.radius || entity.width/2;
        entity.x = Math.max(radius, Math.min(canvas.width - radius, entity.x));
        entity.y = Math.max(radius, Math.min(canvas.height - radius, entity.y));
    };

    if (player.vehicle) {
        boundaryCheck(player.vehicle);
    } else {
        boundaryCheck(player);
    }

    player.bullets.forEach((bullet, index) => {
        bullet.update();
        bullet.draw();

        if(bullet.x < 0 || bullet.x > canvas.width || bullet.y < 0 || bullet.y > canvas.height) {
            player.bullets.splice(index, 1);
        }

        enemies.forEach((enemy, enemyIndex) => {
            const dx = bullet.x - enemy.x;
            const dy = bullet.y - enemy.y;
            const distance = Math.sqrt(dx * dx + dy * dy);
            
            if(distance < enemy.radius + bullet.radius) {
                enemy.health -= bullet.damage;
                player.bullets.splice(index, 1);
                
                if(enemy.health <= 0) {
                    enemies.splice(enemyIndex, 1);
                }
            }
        });
    });

    vehicles.forEach(vehicle => vehicle.draw());
    
    player.draw();
    enemies.forEach(enemy => {
        enemy.draw();
        
        const dx = player.x - enemy.x;
        const dy = player.y - enemy.y;
        const angle = Math.atan2(dy, dx);
        enemy.x += Math.cos(angle) * (enemy.speed * 0.5);
        enemy.y += Math.sin(angle) * (enemy.speed * 0.5);
        enemy.angle = angle;
        
        if(Math.random() < 0.02) {
            enemy.shoot();
        }

        enemy.bullets.forEach((bullet, index) => {
            bullet.update();
            bullet.draw();

            const dx = bullet.x - player.x;
            const dy = bullet.y - player.y;
            const distance = Math.sqrt(dx * dx + dy * dy);
            
            if(distance < player.radius + bullet.radius) {
                if (player.vehicle) {
                    player.vehicle.health -= bullet.damage/2;
                    if (player.vehicle.health <= 0) {
                        player.exitVehicle();
                    }
                } else {
                    player.health -= bullet.damage;
                }
                enemy.bullets.splice(index, 1);
                
                if(player.health <= 0) {
                    alert('Game Over!');
                    window.location.reload();
                }
            }
        });
    });

    requestAnimationFrame(gameLoop);
}

gameLoop();
</script>
</body>
</html>
